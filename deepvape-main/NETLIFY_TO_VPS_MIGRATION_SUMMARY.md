# Netlify åˆ° Vultr VPS é·ç§»ç¸½çµ

## å®Œæˆçš„å·¥ä½œ

### 1. âœ… å»ºç«‹å®Œæ•´çš„å¾Œç«¯ä¼ºæœå™¨ (`server.js`)
- **Express ä¼ºæœå™¨**ï¼šè™•ç†æ‰€æœ‰ API è«‹æ±‚
- **API è·¯ç”±å™¨**ï¼šçµ„ç¹”åŒ–çš„ API ç«¯é»ç®¡ç†
- **éœæ…‹æª”æ¡ˆæœå‹™**ï¼šé–‹ç™¼ç’°å¢ƒæ”¯æ´
- **éŒ¯èª¤è™•ç†**ï¼šå®Œæ•´çš„éŒ¯èª¤è™•ç†ä¸­é–“ä»¶
- **å®‰å…¨æ¨™é ­**ï¼šç”Ÿç”¢ç’°å¢ƒå®‰å…¨æ€§è¨­å®š

### 2. âœ… å¯¦ä½œæ‰€æœ‰ API ç«¯é»
- **`/api/health`** - å¥åº·æª¢æŸ¥
- **`/api/prices`** - åƒ¹æ ¼è³‡æ–™ API
- **`/api/announcements`** - å…¬å‘Šè³‡æ–™ API  
- **`/api/send-telegram`** - Telegram é€šçŸ¥ API
- **`/api/711-callback`** - 7-11 é–€å¸‚å›èª¿è™•ç†

### 3. âœ… è³‡æ–™ç®¡ç†
- **`data/prices.json`** - ç”¢å“åƒ¹æ ¼è³‡æ–™
- **`data/announcements.json`** - ç¶²ç«™å…¬å‘Šè³‡æ–™
- ä¼ºæœå™¨å•Ÿå‹•æ™‚è‡ªå‹•è¼‰å…¥è³‡æ–™æª”æ¡ˆ

### 4. âœ… å‰ç«¯é…ç½®æ›´æ–° (`js/config.js`)
- **API åŸºç¤ URL**ï¼šè‡ªå‹•åµæ¸¬é–‹ç™¼/ç”Ÿç”¢ç’°å¢ƒ
- **çµ±ä¸€çš„ API æ–¹æ³•**ï¼š`window.API` ç‰©ä»¶
- **è«‹æ±‚è¼”åŠ©å‡½æ•¸**ï¼š`window.apiRequest()`
- **é–‹ç™¼å·¥å…·**ï¼šAPI æ¸¬è©¦åŠŸèƒ½

### 5. âœ… Nginx ç”Ÿç”¢ç’°å¢ƒé…ç½® (`nginx/deepvape.conf`)
- **SSL/TLS æ”¯æ´**ï¼šLet's Encrypt æ•´åˆ
- **HTTP/2**ï¼šæ•ˆèƒ½å„ªåŒ–
- **åå‘ä»£ç†**ï¼šå°‡ API è«‹æ±‚è½‰ç™¼åˆ° Node.js
- **éœæ…‹æª”æ¡ˆå¿«å–**ï¼šå„ªåŒ–è¼‰å…¥é€Ÿåº¦
- **å®‰å…¨è¨­å®š**ï¼šé˜²è­·å¸¸è¦‹æ”»æ“Š
- **é€Ÿç‡é™åˆ¶**ï¼šAPI ä¿è­·

### 6. âœ… éƒ¨ç½²ç›¸é—œæª”æ¡ˆ
- **`env.example`** - ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
- **`MIGRATION_GUIDE.md`** - è©³ç´°é·ç§»æŒ‡å—
- **`scripts/test-apis.js`** - API æ¸¬è©¦è…³æœ¬

## API ç«¯é»å°æ‡‰

| åŠŸèƒ½ | Netlify Function | VPS API ç«¯é» |
|-----|-----------------|--------------|
| Telegram é€šçŸ¥ | `/.netlify/functions/send-telegram` | `/api/send-telegram` |
| 7-11 å›èª¿ | `cvs_callback.html` | `/api/711-callback` |
| å¥åº·æª¢æŸ¥ | N/A | `/api/health` |
| åƒ¹æ ¼è³‡æ–™ | éœæ…‹ JSON | `/api/prices` |
| å…¬å‘Šè³‡æ–™ | éœæ…‹ JSON | `/api/announcements` |

## éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### å‰ç½®æº–å‚™
- [ ] Vultr Ubuntu 22.04 VPS
- [ ] åŸŸå DNS æŒ‡å‘ VPS IP
- [ ] SSH é‡‘é‘°è¨­å®š

### ä¼ºæœå™¨è¨­å®š
- [ ] å®‰è£ Node.js 18.x
- [ ] å®‰è£ Nginx
- [ ] å®‰è£ PM2
- [ ] è¨­å®šé˜²ç«ç‰†

### æ‡‰ç”¨éƒ¨ç½²
- [ ] Clone å°ˆæ¡ˆåˆ° `/var/www/deepvape`
- [ ] åŸ·è¡Œ `npm install`
- [ ] å»ºç«‹ `.env` æª”æ¡ˆ
- [ ] åŸ·è¡Œ `npm run build`
- [ ] è¨­å®š Nginx
- [ ] å–å¾— SSL è­‰æ›¸

### å•Ÿå‹•æœå‹™
- [ ] å•Ÿå‹• PM2ï¼š`npm run pm2:start`
- [ ] æ¸¬è©¦ APIï¼š`node scripts/test-apis.js`
- [ ] é©—è­‰ç¶²ç«™åŠŸèƒ½

## ä¸»è¦æ”¹é€²

1. **å®Œæ•´çš„å¾Œç«¯æ§åˆ¶**ï¼šä¸å†ä¾è³´ Netlify Functions
2. **æ›´å¥½çš„æ•ˆèƒ½**ï¼šNginx è™•ç†éœæ…‹æª”æ¡ˆï¼ŒNode.js å°ˆæ³¨æ–¼ API
3. **å¯æ“´å±•æ€§**ï¼šPM2 å¢é›†æ¨¡å¼æ”¯æ´è‡ªå‹•æ“´å±•
4. **æˆæœ¬æ•ˆç›Š**ï¼šå›ºå®šæœˆè²»ï¼Œç„¡ serverless å‡½æ•¸é™åˆ¶
5. **ç›£æ§èƒ½åŠ›**ï¼šå®Œæ•´çš„æ—¥èªŒå’Œç›£æ§é¸é …

## æ¸¬è©¦å‘½ä»¤

```bash
# æœ¬åœ°é–‹ç™¼
npm run dev

# å»ºæ§‹ç”Ÿç”¢ç‰ˆæœ¬
npm run build

# æ¸¬è©¦ API
node scripts/test-apis.js

# éƒ¨ç½²å‰æª¢æŸ¥
npm run deploy:check

# PM2 æ“ä½œ
npm run pm2:start    # å•Ÿå‹•
npm run pm2:reload   # é‡æ–°è¼‰å…¥
npm run pm2:logs     # æŸ¥çœ‹æ—¥èªŒ
```

## ç’°å¢ƒè®Šæ•¸è¨­å®š

å¿…è¦çš„ç’°å¢ƒè®Šæ•¸ï¼š
```env
NODE_ENV=production
PORT=3000
TELEGRAM_BOT_TOKEN=your_token
TELEGRAM_CHAT_ID=your_chat_id
CORS_ORIGINS=https://52012.xyz,https://52012.xyz
```

## æ³¨æ„äº‹é …

1. **7-11 API å›èª¿**ï¼šç¢ºä¿åœ¨ 7-11 ç³»çµ±ä¸­æ›´æ–°å›èª¿ URL ç‚º `https://52012.xyz/api/711-callback`
2. **Telegram è¨­å®š**ï¼šéœ€è¦æœ‰æ•ˆçš„ Bot Token å’Œ Chat ID
3. **SSL è­‰æ›¸**ï¼šä½¿ç”¨ Let's Encrypt è‡ªå‹•æ›´æ–°
4. **å‚™ä»½ç­–ç•¥**ï¼šå®šæœŸå‚™ä»½ `data/` ç›®éŒ„å’Œ `.env` æª”æ¡ˆ

## é·ç§»å¾Œçš„æ¶æ§‹

```
ä½¿ç”¨è€… <-> Nginx (443/80) <-> Node.js (3000) <-> è³‡æ–™æª”æ¡ˆ
                |
                â””-> éœæ…‹æª”æ¡ˆ (dist/)
```

## æ”¯æ´èˆ‡ç¶­è­·

- æŸ¥çœ‹æ—¥èªŒï¼š`pm2 logs`
- ç›£æ§ç‹€æ…‹ï¼š`pm2 monit`
- æ›´æ–°ç¨‹å¼ç¢¼ï¼š`git pull && npm install && npm run build && pm2 reload`

é·ç§»å·²å®Œæˆæº–å‚™ï¼ğŸ‰ 